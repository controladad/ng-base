<div class="flex overflow-hidden h-full">
  <feature-dialog-layout
    class="{{ data.viewOnly ? 'w-0 block overflow-hidden' : '' }}"
    [title]="data.item ? 'ویرایش نقش' : 'اضافه کردن نقش'"
    [subtitle]="'مشخصات و اطلاعات پایه نقش را وارد کنید'"
    [hideControls]="!!data.viewOnly"
    [form]="baseForm.formGroup"
    (onSubmit)="onSubmit($event)"
  >
    <feature-form-builder [options]="baseForm"></feature-form-builder>
  </feature-dialog-layout>

  <div class="bg-surface pt-6 py-9 px-11 flex flex-col flex-auto overflow-hidden w-full">
    <div class="flex flex-col">
      <p class="text-surface-on text-xl font-medium">دسترسی ها{{ data.viewOnly ? 'ی نقش ' + data.item?.name : '' }}</p>
      <p *ngIf="!data.viewOnly" class="text-surface-on text-sm mt-2">دسترسی های مجاز برای نقش را انتخاب کنید.</p>
    </div>

    <ui-field
      class="mt-5"
      placeholder="جستجو در دسترسی ها"
      label="جستجو"
      floatLabel="always"
      prefixIcon="search"
      [control]="searchControl"
      [clearable]="true"
    ></ui-field>

    <div class="overflow-auto flex-1 flex flex-col gap-6 px-4 mt-1 pb-12">
      <ng-container *ngIf="visiblePermissionList()?.length; else NoItem">
        <fieldset
          *ngFor="let item of visiblePermissionList() ?? []"
          class="relative flex flex-col border border-outline bg-white rounded-1 py-1 pb-2.5 px-1"
        >
          <legend class="text-xs ms-3 select-none">{{ item.label }}</legend>
          <ui-checkbox [control]="item.selectAllControl">همه</ui-checkbox>
          <ui-checkbox
            *ngFor="let perm of item.permissions"
            class="{{ perm.subLevel ? 'ms-6 text-sm text-outline' : '' }}"
            [control]="perm.control"
            >{{ perm.label }}</ui-checkbox
          >
        </fieldset>
      </ng-container>
      <ng-template #NoItem>
        <div class="mt-16 text-center">
          <p>دسترسی برای این نقش انتخاب نشده...</p>
        </div>
      </ng-template>
    </div>
  </div>
</div>
